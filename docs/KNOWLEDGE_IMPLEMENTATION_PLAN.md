# ãƒŠãƒ¬ãƒƒã‚¸æ©Ÿèƒ½å®Ÿè£…è¨ˆç”»

## ðŸ“‹ ç¾çŠ¶åˆ†æž

### âœ… æ—¢ã«å®Ÿè£…æ¸ˆã¿
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰UIï¼ˆ`app/(app)/knowledge/page.tsx`ï¼‰
  - æ¤œç´¢æ©Ÿèƒ½
  - ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ»ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
  - ä¸¦ã³æ›¿ãˆæ©Ÿèƒ½ï¼ˆäººæ°—é †ãƒ»è©•ä¾¡é †ãƒ»æ–°ç€é †ï¼‰
- ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ï¼ˆ`data/mockData.ts`ï¼‰
  - KnowledgeItemåž‹å®šç¾©
  - ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿

### âŒ æœªå®Ÿè£…
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº
- CRUD API
- å®Ÿãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–

---

## ðŸ¤” DBé€£æºã¯å¿…é ˆã‹ï¼Ÿ

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãªã—ã§è©¦é¨“çš„ã«å®Ÿè£…ã§ãã‚‹ã“ã¨
ç¾åœ¨ã¯**ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã§å‹•ä½œã—ã¦ã„ã‚‹**ãŸã‚ã€ä»¥ä¸‹ã¯æ—¢ã«å¯èƒ½ã§ã™ï¼š
- âœ… ãƒŠãƒ¬ãƒƒã‚¸ã®è¡¨ç¤º
- âœ… æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- âœ… UI/UXã®ç¢ºèª

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒå¿…è¦ã«ãªã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°
ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹éš›ã«**å¿…é ˆ**ã§ã™ï¼š
- âŒ ãƒŠãƒ¬ãƒƒã‚¸ã®æ–°è¦ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- âŒ ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–ï¼ˆãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã‚‚ä¿æŒï¼‰
- âŒ è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ã§ã®ãƒ‡ãƒ¼ã‚¿å…±æœ‰
- âŒ ä½¿ç”¨å›žæ•°ãƒ»è©•ä¾¡ã®ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
- âŒ AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒãƒŠãƒ¬ãƒƒã‚¸ã‚’å‚ç…§ã™ã‚‹æ©Ÿèƒ½

**çµè«–ï¼šæœ¬æ ¼çš„ãªå®Ÿè£…ã«ã¯DBé€£æºãŒå¿…é ˆã§ã™**

---

## ðŸŽ¯ ä»Šæ—¥ã®å®Ÿè£…ç›®æ¨™

ä»Šæ—¥ä¸­ã«ä»¥ä¸‹ã‚’å®Œäº†ã•ã›ã¾ã™ï¼š

1. **Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—** âœ“
2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒžã®ä½œæˆ** âœ“
3. **ãƒŠãƒ¬ãƒƒã‚¸CRUD APIã®å®Ÿè£…** âœ“
4. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨APIã®é€£æº** âœ“
5. **å‹•ä½œç¢ºèª** âœ“

---

## â° ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼ˆä»Šæ—¥ã®ä½œæ¥­ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰

### Phase 1: Supabaseã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆ30åˆ†ã€œ1æ™‚é–“ï¼‰
**ä½œæ¥­å†…å®¹ï¼š**
- Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
- ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
- Supabase JSã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

**æˆæžœç‰©ï¼š**
- `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã«Supabaseèªè¨¼æƒ…å ±
- `@supabase/supabase-js`ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†

---

### Phase 2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒžè¨­è¨ˆï¼ˆ30åˆ†ï¼‰
**ä½œæ¥­å†…å®¹ï¼š**
- `knowledge`ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¨­è¨ˆ
- SQL migrationä½œæˆ
- Supabaseã§å®Ÿè¡Œ

**ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ï¼š**
```sql
CREATE TABLE knowledge (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  category TEXT NOT NULL,
  department TEXT NOT NULL,
  tags TEXT[] DEFAULT '{}',
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  usage_count INTEGER DEFAULT 0,
  helpful INTEGER DEFAULT 0,
  rating DECIMAL(2,1) DEFAULT 0.0,
  created_by UUID REFERENCES auth.users(id),

  -- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  CONSTRAINT knowledge_rating_check CHECK (rating >= 0 AND rating <= 5)
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ
CREATE INDEX idx_knowledge_category ON knowledge(category);
CREATE INDEX idx_knowledge_department ON knowledge(department);
CREATE INDEX idx_knowledge_created_at ON knowledge(created_at DESC);
CREATE INDEX idx_knowledge_usage_count ON knowledge(usage_count DESC);
CREATE INDEX idx_knowledge_rating ON knowledge(rating DESC);

-- å…¨æ–‡æ¤œç´¢ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_knowledge_search ON knowledge USING gin(to_tsvector('japanese', title || ' ' || content));

-- ã‚¿ã‚°æ¤œç´¢ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_knowledge_tags ON knowledge USING gin(tags);

-- æ›´æ–°æ—¥æ™‚ã®è‡ªå‹•æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_knowledge_updated_at
  BEFORE UPDATE ON knowledge
  FOR EACH ROW
  EXECUTE FUNCTION update_updated_at_column();
```

**æˆæžœç‰©ï¼š**
- `knowledge`ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆå®Œäº†
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­å®šå®Œäº†

---

### Phase 3: CRUD APIå®Ÿè£…ï¼ˆ1ã€œ2æ™‚é–“ï¼‰
**ä½œæ¥­å†…å®¹ï¼š**
- `/api/knowledge` - ãƒŠãƒ¬ãƒƒã‚¸ä¸€è¦§å–å¾—ãƒ»ä½œæˆ
- `/api/knowledge/[id]` - å€‹åˆ¥å–å¾—ãƒ»æ›´æ–°ãƒ»å‰Šé™¤
- `/api/knowledge/search` - é«˜åº¦ãªæ¤œç´¢

**APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼š**

#### `GET /api/knowledge`
ãƒŠãƒ¬ãƒƒã‚¸ä¸€è¦§ã‚’å–å¾—ï¼ˆæ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¯¾å¿œï¼‰

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼š**
- `search`: æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
- `category`: ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- `tags`: ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆã‚«ãƒ³ãƒžåŒºåˆ‡ã‚Šï¼‰
- `sortBy`: ä¸¦ã³é †ï¼ˆ`popular`, `rating`, `recent`ï¼‰
- `limit`: å–å¾—ä»¶æ•°
- `offset`: ã‚ªãƒ•ã‚»ãƒƒãƒˆ

#### `POST /api/knowledge`
æ–°è¦ãƒŠãƒ¬ãƒƒã‚¸ä½œæˆ

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ï¼š**
```json
{
  "title": "string",
  "content": "string",
  "category": "string",
  "department": "string",
  "tags": ["string"]
}
```

#### `GET /api/knowledge/[id]`
ç‰¹å®šã®ãƒŠãƒ¬ãƒƒã‚¸ã‚’å–å¾—

#### `PATCH /api/knowledge/[id]`
ãƒŠãƒ¬ãƒƒã‚¸ã‚’æ›´æ–°

#### `DELETE /api/knowledge/[id]`
ãƒŠãƒ¬ãƒƒã‚¸ã‚’å‰Šé™¤

#### `POST /api/knowledge/[id]/use`
ä½¿ç”¨å›žæ•°ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ

**æˆæžœç‰©ï¼š**
- å…¨APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…å®Œäº†
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Ÿè£…

---

### Phase 4: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é€£æºï¼ˆ1æ™‚é–“ï¼‰
**ä½œæ¥­å†…å®¹ï¼š**
- ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰APIå‘¼ã³å‡ºã—ã¸åˆ‡ã‚Šæ›¿ãˆ
- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®å®Ÿè£…
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- æ–°è¦ä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ«ã®å®Ÿè£…
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°

**å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ï¼š**
- `app/(app)/knowledge/page.tsx`
- æ–°è¦ä½œæˆ: `components/KnowledgeCreateModal.tsx`
- æ–°è¦ä½œæˆ: `hooks/useKnowledge.ts`ï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ï¼‰

**æˆæžœç‰©ï¼š**
- APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—
- æ–°è¦ä½œæˆæ©Ÿèƒ½
- ç·¨é›†ãƒ»å‰Šé™¤æ©Ÿèƒ½

---

### Phase 5: å‹•ä½œç¢ºèªï¼ˆ30åˆ†ï¼‰
**ãƒ†ã‚¹ãƒˆé …ç›®ï¼š**
- [ ] ãƒŠãƒ¬ãƒƒã‚¸ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] æ¤œç´¢æ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹
- [ ] ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ»ã‚¿ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒå‹•ä½œã™ã‚‹
- [ ] ä¸¦ã³æ›¿ãˆãŒå‹•ä½œã™ã‚‹
- [ ] æ–°è¦ä½œæˆãŒã§ãã‚‹
- [ ] ç·¨é›†ãŒã§ãã‚‹
- [ ] å‰Šé™¤ãŒã§ãã‚‹
- [ ] ä½¿ç”¨å›žæ•°ãŒã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã•ã‚Œã‚‹

**æˆæžœç‰©ï¼š**
- å‹•ä½œç¢ºèªå®Œäº†
- ãƒã‚°ä¿®æ­£å®Œäº†

---

## ðŸ“¦ å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```bash
npm install @supabase/supabase-js
```

---

## ðŸ” ç’°å¢ƒå¤‰æ•°

`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼š

```env
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
```

---

## ðŸš€ å®Ÿè£…é–‹å§‹ã®æº–å‚™ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] Supabaseã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆï¼ˆhttps://supabase.comï¼‰
- [ ] æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
- [ ] ç’°å¢ƒå¤‰æ•°ã®å–å¾—
- [ ] `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°

---

## ðŸ“ å®Ÿè£…å¾Œã®è¿½åŠ æ©Ÿèƒ½ï¼ˆå°†æ¥çš„ã«ï¼‰

### ãƒ•ã‚§ãƒ¼ã‚º2ï¼ˆå¾Œæ—¥å®Ÿè£…ï¼‰
- [ ] ãƒŠãƒ¬ãƒƒã‚¸ã®æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œï¼ˆSupabase Storageï¼‰
- [ ] ãƒžãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚¨ãƒ‡ã‚£ã‚¿
- [ ] ãƒãƒ¼ã‚¸ãƒ§ãƒ³å±¥æ­´
- [ ] ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½
- [ ] ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½

### ãƒ•ã‚§ãƒ¼ã‚º3ï¼ˆAIé€£æºï¼‰
- [ ] AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒãƒŠãƒ¬ãƒƒã‚¸ã‚’å‚ç…§
- [ ] è‡ªå‹•ã‚¿ã‚°ä»˜ã‘
- [ ] é¡žä¼¼ãƒŠãƒ¬ãƒƒã‚¸ã®æŽ¨è–¦
- [ ] ãƒŠãƒ¬ãƒƒã‚¸ã®è‡ªå‹•è¦ç´„

---

## ðŸ’¡ ãªãœSupabaseã‚’é¸ã¶ã®ã‹ï¼Ÿ

### ãƒ¡ãƒªãƒƒãƒˆ
1. **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒé€Ÿã„**ï¼šæ•°åˆ†ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒä½¿ãˆã‚‹
2. **PostgreSQLãƒ™ãƒ¼ã‚¹**ï¼šæœ¬æ ¼çš„ãªRDBMS
3. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½**ï¼šWebSocketã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ãŒå¯èƒ½
4. **èªè¨¼æ©Ÿèƒ½**ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã‚‚ç°¡å˜ã«å®Ÿè£…å¯èƒ½
5. **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**ï¼šãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚‚å¯¾å¿œ
6. **ç„¡æ–™æž ãŒå……å®Ÿ**ï¼šé–‹ç™ºæ®µéšŽã§ã¯ç„¡æ–™ã§ä½¿ãˆã‚‹

### ä»£æ›¿æ¡ˆ
- **Prisma + PostgreSQLï¼ˆRailway/Vercel Postgresï¼‰**
  - ã‚ˆã‚Šç´°ã‹ã„åˆ¶å¾¡ãŒå¯èƒ½
  - ORMã§ã‚¿ã‚¤ãƒ—ã‚»ãƒ¼ãƒ•
  - ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«å°‘ã—æ™‚é–“ãŒã‹ã‹ã‚‹

- **Firebase Firestore**
  - NoSQL
  - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ãŒå¾—æ„
  - è¤‡é›‘ãªã‚¯ã‚¨ãƒªã«ã¯å‘ã‹ãªã„

**ä»Šå›žã¯Supabaseã‚’æŽ¨å¥¨ã—ã¾ã™**ï¼ˆã‚¹ãƒ”ãƒ¼ãƒ‰é‡è¦–ã®ãŸã‚ï¼‰

---

## ðŸŽ¯ å®Ÿè£…ã®æµã‚Œ

```
ç¾åœ¨ã®çŠ¶æ…‹
    â†“
[Phase 1] Supabaseã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— (30åˆ†ã€œ1æ™‚é–“)
    â†“
[Phase 2] DBã‚¹ã‚­ãƒ¼ãƒžä½œæˆ (30åˆ†)
    â†“
[Phase 3] APIå®Ÿè£… (1ã€œ2æ™‚é–“)
    â†“
[Phase 4] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é€£æº (1æ™‚é–“)
    â†“
[Phase 5] å‹•ä½œç¢ºèª (30åˆ†)
    â†“
å®Œæˆï¼
```

**åˆè¨ˆæ‰€è¦æ™‚é–“ï¼š3.5ã€œ5æ™‚é–“**

---

## ðŸ“ž æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèª
2. Supabaseã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æº–å‚™ãŒã§ããŸã‚‰å®Ÿè£…é–‹å§‹
3. å„ãƒ•ã‚§ãƒ¼ã‚ºã”ã¨ã«å‹•ä½œç¢ºèªã—ãªãŒã‚‰é€²ã‚ã‚‹

---

æœ€çµ‚æ›´æ–°: 2025-11-19
ä½œæˆè€…: Claude Code Assistant

# 📁 ファイル対応拡張完了！

## ✅ 新たに対応したファイル形式

### 1. Excel (.xlsx, .xls) 📊
- 全シートのデータを抽出
- CSV形式に変換して保存
- `xlsx` パッケージ使用

### 2. PowerPoint (.pptx, .ppt) 📽️
- スライドのテキストを抽出
- ノートも含めて取得可能
- `officeparser` パッケージ使用

### 3. CSV (.csv) 📈
- カラムごとにパース
- 全行のデータを結合
- `csv-parse` パッケージ使用

### 4. 画像 (.png, .jpg, .jpeg, .gif, .webp) 🖼️
- **OCR (光学文字認識)** でテキスト抽出
- 日本語と英語に対応
- `tesseract.js` パッケージ使用

---

## 📦 対応ファイル形式一覧

| 形式 | 拡張子 | アイコン | 説明 |
|------|--------|---------|------|
| PDF | .pdf | 📄 | PDFからテキスト抽出 |
| Word | .docx | 📝 | Wordドキュメント |
| Excel | .xlsx, .xls | 📊 | 全シートのデータ抽出 |
| PowerPoint | .pptx, .ppt | 📽️ | スライドのテキスト抽出 |
| CSV | .csv | 📈 | カンマ区切りデータ |
| テキスト | .txt | 📃 | プレーンテキスト |
| Markdown | .md | 📃 | マークダウン |
| 画像 | .png, .jpg, .gif, .webp | 🖼️ | OCRでテキスト抽出 |

---

## 🚀 使い方

### 1. ナレッジページでアップロード

http://localhost:3001/knowledge

1. 「ドキュメント追加」ボタンをクリック
2. 任意のファイルを選択（上記対応形式）
3. 自動でテキスト抽出が開始
4. 数秒後に「処理済み」になる

### 2. 画像のOCR処理について

**注意点:**
- 画像からのテキスト抽出は**時間がかかります**（数秒〜数十秒）
- 画質が良いほど精度が高い
- 日本語 + 英語の混在も対応

**推奨:**
- スクリーンショット、スキャンした文書など
- PDFの方が高速・高精度なので、可能ならPDFを推奨

---

## 🔧 技術詳細

### 使用ライブラリ

```json
{
  "xlsx": "Excel読み込み",
  "officeparser": "PowerPoint読み込み",
  "csv-parse": "CSV解析",
  "tesseract.js": "OCR処理",
  "pdf-parse": "PDF読み込み",
  "mammoth": "Word読み込み"
}
```

### テキスト抽出の流れ

1. **アップロード**
   - ファイルをSupabase Storageに保存
   - DBに記録（processed: false）

2. **バックグラウンド処理**
   - ファイル形式に応じて適切なライブラリで抽出
   - テキストを2000文字ごとにチャンク分割
   - `document_chunks`テーブルに保存

3. **完了**
   - processed: true に更新
   - チャットで検索可能に

---

## 🎯 チャットでの活用

アップロードしたドキュメントは、チャットで自動的に検索されます：

**例:**
- Excel: 「売上データを教えて」
- PowerPoint: 「プレゼンの概要は？」
- 画像: 「このスクリーンショットに書いてあることは？」

AIが関連するドキュメントを見つけて、内容を参照しながら回答します。

---

## 📝 今後の拡張可能性

- [ ] 音声ファイル (.mp3, .wav) → 文字起こし
- [ ] 動画ファイル (.mp4) → 字幕抽出
- [ ] ZIPファイル → 中身を展開して処理
- [ ] URLからWebページを取得

---

最終更新: 2025-11-19

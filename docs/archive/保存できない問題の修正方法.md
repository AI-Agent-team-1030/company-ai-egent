# 🚨 設定が保存できない問題の修正方法

## 症状
- ユーザー名を入力して「保存」を押しても、リロードすると消える
- Claude APIキーを保存しても、反映されない
- 「保存しました」と表示されるが、実際には保存されていない

## 原因
データベースにUNIQUE制約が設定されていないため、保存（upsert）が正しく動作していません。

## 修正方法（3ステップ）

### ステップ1: Supabaseを開く
1. https://supabase.com/dashboard/ にアクセス
2. プロジェクトを選択
3. 左メニューから「SQL Editor」をクリック

### ステップ2: SQLを実行
`supabase/FIX_CONSTRAINTS.sql` ファイルを開いて、**全ての内容をコピー**してSQL Editorに貼り付けて実行してください。

実行後、以下のメッセージが表示されればOK：
```
status: "FIX completed successfully! Settings can now be saved."
```

### ステップ3: 動作確認
1. ブラウザで http://localhost:3000/settings を開く
2. ユーザー名を入力して「名前を保存」をクリック
3. **ページをリロード（F5キー）**
4. ユーザー名が残っていればOK！

同様に、Claude APIキーも保存して確認してください。

---

## トラブルシューティング

### それでも保存できない場合

#### 1. サーバーを再起動
```bash
# ターミナルで Ctrl+C を押してサーバーを停止
cd "/Users/kurosakiyuto/法人AI素案"
rm -rf .next
npm run dev
```

#### 2. データベースの状態を確認
`supabase/CHECK_DATABASE.sql` を実行して、データベースの状態を確認してください。

#### 3. ブラウザのコンソールを確認
- F12キーを押して、Consoleタブを開く
- 保存ボタンを押した時にエラーが出ていないか確認
- 赤いエラーメッセージがあれば、その内容を確認

---

## 詳細な手順

詳しい手順は `supabase/README.md` を参照してください。

---

## SQLファイル一覧

### 必ず実行
- **supabase/FIX_CONSTRAINTS.sql** - 保存の問題を修正（これを実行してください！）

### 初回セットアップ時のみ
- **supabase/SETUP.sql** - データベース初期セットアップ

### オプション
- **supabase/CHECK_DATABASE.sql** - データベースの状態を確認

---

## サーバー起動方法

```bash
cd "/Users/kurosakiyuto/法人AI素案"
npm run dev
```

ブラウザで http://localhost:3000 を開く

---

## 完了チェックリスト

- [ ] FIX_CONSTRAINTS.sqlを実行した
- [ ] 「FIX completed successfully!」と表示された
- [ ] サーバーを起動した
- [ ] ユーザー名を保存してリロードしても残る
- [ ] Claude APIキーを保存してリロードしても「設定済み」と表示される

すべてにチェックが入れば完了です！
